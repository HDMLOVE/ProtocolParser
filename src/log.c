// 打印报文数据包接口

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int g_hexdump_enable = 0;

int is_hexdump_enable()
{
  return g_hexdump_enable;
}

static void print_ansi_at_line(void *data, unsigned int len)
{
  unsigned int i;
  unsigned char *ptr = (unsigned char *)data;
  printf("   ");
  for(i=0; i<len; i++){
    if(ptr[i] >= 0x20 && ptr[i] <= 0x7e)
      printf("%c", ptr[i]);
    else
      printf(".");
  }
}

void debug_hex_println(char *begin, void *data, unsigned int len)
{  
  unsigned int i, tmp = 0;
  unsigned char *ptr = (unsigned char *)data;
  if(!is_hexdump_enable)
    return;
  
  printf("\n%s----start---- len %u\n", begin, len);
  for(i=0; i<len; i++){
    printf("%02x ", ptr[i]);
    if((i+1)%16 == 0){
      print_ansi_at_line(&ptr[i-15], 16);
      printf("\n");
    }
  }
  for(tmp = i; tmp%16 != 0; tmp++){
    printf("   ");
  }
  if(i != 0)
    print_ansi_at_line(&ptr[i-i%16], i%16+1);
  printf("\n%s----end----\n\n", begin);
}

// test data
#if 0
char peer0_6[] = { /* Packet 32 */
0x00, 0x00, 0x84, 0x00, 0x00, 0x00, 0x00, 0x04, 
0x00, 0x00, 0x00, 0x02, 0x04, 0x69, 0x50, 0x61, 
0x64, 0x0f, 0x5f, 0x63, 0x6f, 0x6d, 0x70, 0x61, 
0x6e, 0x69, 0x6f, 0x6e, 0x2d, 0x6c, 0x69, 0x6e, 
0x6b, 0x04, 0x5f, 0x74, 0x63, 0x70, 0x05, 0x6c, 
0x6f, 0x63, 0x61, 0x6c, 0x00, 0x00, 0x10, 0x80, 
0x01, 0x00, 0x00, 0x11, 0x94, 0x00, 0x5b, 0x16, 
0x72, 0x70, 0x42, 0x41, 0x3d, 0x32, 0x43, 0x3a, 
0x39, 0x36, 0x3a, 0x35, 0x34, 0x3a, 0x33, 0x43, 
0x3a, 0x46, 0x45, 0x3a, 0x43, 0x43, 0x11, 0x72, 
0x70, 0x41, 0x44, 0x3d, 0x39, 0x35, 0x66, 0x61, 
0x32, 0x65, 0x65, 0x66, 0x62, 0x35, 0x64, 0x33, 
0x0c, 0x72, 0x70, 0x46, 0x6c, 0x3d, 0x30, 0x78, 
0x33, 0x30, 0x30, 0x30, 0x30, 0x11, 0x72, 0x70, 
0x48, 0x4e, 0x3d, 0x30, 0x34, 0x31, 0x65, 0x34, 
0x61, 0x37, 0x33, 0x63, 0x65, 0x65, 0x62, 0x07, 
0x72, 0x70, 0x4d, 0x61, 0x63, 0x3d, 0x30, 0x0a, 
0x72, 0x70, 0x56, 0x72, 0x3d, 0x32, 0x33, 0x30, 
0x2e, 0x31, 0xc0, 0x11, 0x00, 0x0c, 0x00, 0x01, 
0x00, 0x00, 0x11, 0x94, 0x00, 0x02, 0xc0, 0x0c, 
0x04, 0x69, 0x50, 0x61, 0x64, 0x0c, 0x5f, 0x64, 
0x65, 0x76, 0x69, 0x63, 0x65, 0x2d, 0x69, 0x6e, 
0x66, 0x6f, 0xc0, 0x21, 0x00, 0x10, 0x00, 0x01, 
0x00, 0x00, 0x11, 0x94, 0x00, 0x0d, 0x0c, 0x6d, 
0x6f, 0x64, 0x65, 0x6c, 0x3d, 0x4a, 0x31, 0x37, 
0x31, 0x41, 0x50, 0xc0, 0x0c, 0x00, 0x21, 0x80, 
0x01, 0x00, 0x00, 0x00, 0x78, 0x00, 0x0d, 0x00, 
0x00, 0x00, 0x00, 0xca, 0x1b, 0x04, 0x69, 0x50, 
0x61, 0x64, 0xc0, 0x26, 0xc0, 0x0c, 0x00, 0x2f, 
0x80, 0x01, 0x00, 0x00, 0x11, 0x94, 0x00, 0x09, 
0xc0, 0x0c, 0x00, 0x05, 0x00, 0x00, 0x80, 0x00, 
0x40, 0x00, 0x00, 0x29, 0x05, 0xa0, 0x00, 0x00, 
0x11, 0x94, 0x00, 0x12, 0x00, 0x04, 0x00, 0x0e, 
0x00, 0xdc, 0x7e, 0xab, 0x60, 0xc7, 0xe9, 0x55, 
0x42, 0x26, 0x71, 0x1e, 0x4a, 0x23 };

int main(int argc, char *argv[])
{
  //char *str="hello ni hao a das ad adsa da ada dsa sadsa asd adsa dasdsadasdsa ";
  debug_hex_println(NULL, peer0_6, sizeof(peer0_6)/sizeof(peer0_6[0]));
  return 0;
}
#endif
